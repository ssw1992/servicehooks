{"version":3,"file":"index2.js","sources":["../packages/login/index.ts"],"sourcesContent":["import { onUnmounted, ref } from \"vue\";\r\n\r\ninterface ScanLoginConfig {\r\n  timeout?: number;\r\n  intevalTimeout?: number;\r\n  getSecret: () => Promise<string>;\r\n  verifyLogin: (str: string) => Promise<any>;\r\n  onPass?: (str: string) => void;\r\n  onTimeout?: () => void;\r\n}\r\n\r\nexport const useScanLogin = ({\r\n  getSecret,\r\n  intevalTimeout = 3 * 1000,\r\n  timeout = 180 * 1000,\r\n  verifyLogin,\r\n  onPass,\r\n}: ScanLoginConfig) => {\r\n  const isTimeout = ref(false);\r\n  const isLoading = ref(false);\r\n  let theInterval: number | null;\r\n  let time = 0;\r\n  let theSecret: string | null;\r\n\r\n  const start = async () => {\r\n    isTimeout.value = false;\r\n    time = 0;\r\n    isLoading.value = true;\r\n    try {\r\n      theSecret = null;\r\n      theSecret = await getSecret();\r\n    } catch (error) {\r\n      console.log(\"获取密钥失败\", error);\r\n      throw new Error(\"获取密钥失败\");\r\n    }\r\n    isLoading.value = false;\r\n    if (!theSecret) {\r\n      return;\r\n    }\r\n    theInterval = window.setInterval(async () => {\r\n      time += intevalTimeout;\r\n      if (time > timeout) {\r\n        return stop();\r\n      }\r\n\r\n      try {\r\n        const loginInfo = await verifyLogin(theSecret as string);\r\n        if (loginInfo) {\r\n          stop();\r\n          onPass && onPass(loginInfo);\r\n        }\r\n      } catch (error) {\r\n        stop();\r\n        console.error(\"校验登录失败\", error);\r\n        throw new Error(\"校验登录失败\");\r\n      }\r\n    }, intevalTimeout);\r\n  };\r\n  const stop = () => {\r\n    isTimeout.value = true;\r\n    theInterval && clearInterval(theInterval);\r\n  };\r\n\r\n  onUnmounted(stop);\r\n  return {\r\n    isTimeout,\r\n    isLoading,\r\n    start,\r\n  };\r\n};\r\n"],"names":["useScanLogin","getSecret","intevalTimeout","timeout","verifyLogin","onPass","isTimeout","ref","isLoading","theInterval","time","theSecret","start","error","stop","loginInfo","onUnmounted"],"mappings":";AAWO,MAAMA,IAAe,CAAC;AAAA,EAC3B,WAAAC;AAAA,EACA,gBAAAC,IAAiB,IAAI;AAAA,EACrB,SAAAC,IAAU,MAAM;AAAA,EAChB,aAAAC;AAAA,EACA,QAAAC;AACF,MAAuB;AACf,QAAAC,IAAYC,EAAI,EAAK,GACrBC,IAAYD,EAAI,EAAK;AACvB,MAAAE,GACAC,IAAO,GACPC;AAEJ,QAAMC,IAAQ,YAAY;AACxB,IAAAN,EAAU,QAAQ,IACXI,IAAA,GACPF,EAAU,QAAQ;AACd,QAAA;AACU,MAAAG,IAAA,MACZA,IAAY,MAAMV;aACXY,GAAO;AACN,oBAAA,IAAI,UAAUA,CAAK,GACrB,IAAI,MAAM,QAAQ;AAAA,IAC1B;AAEA,IADAL,EAAU,QAAQ,IACbG,MAGSF,IAAA,OAAO,YAAY,YAAY;AAE3C,UADQC,KAAAR,GACJQ,IAAOP;AACT,eAAOW,EAAK;AAGV,UAAA;AACI,cAAAC,IAAY,MAAMX,EAAYO,CAAmB;AACvD,QAAII,MACGD,KACLT,KAAUA,EAAOU,CAAS;AAAA,eAErBF,GAAO;AACT,cAAAC,KACG,QAAA,MAAM,UAAUD,CAAK,GACvB,IAAI,MAAM,QAAQ;AAAA,MAC1B;AAAA,OACCX,CAAc;AAAA,EAAA,GAEbY,IAAO,MAAM;AACjB,IAAAR,EAAU,QAAQ,IAClBG,KAAe,cAAcA,CAAW;AAAA,EAAA;AAG1C,SAAAO,EAAYF,CAAI,GACT;AAAA,IACL,WAAAR;AAAA,IACA,WAAAE;AAAA,IACA,OAAAI;AAAA,EAAA;AAEJ;"}