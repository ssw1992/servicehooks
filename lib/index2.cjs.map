{"version":3,"file":"index2.cjs","sources":["../packages/login/index.ts"],"sourcesContent":["import { onUnmounted, ref } from \"vue\";\r\n\r\ninterface ScanLoginConfig {\r\n  timeout?: number;\r\n  intevalTimeout?: number;\r\n  getSecret: () => Promise<string>;\r\n  verifyLogin: (str: string) => Promise<any>;\r\n  onPass?: (str: string) => void;\r\n  onTimeout?: () => void;\r\n}\r\n\r\nexport const useScanLogin = ({\r\n  getSecret,\r\n  intevalTimeout = 3 * 1000,\r\n  timeout = 180 * 1000,\r\n  verifyLogin,\r\n  onPass,\r\n}: ScanLoginConfig) => {\r\n  const isTimeout = ref(false);\r\n  const isLoading = ref(false);\r\n  let theInterval: number | null;\r\n  let time = 0;\r\n  let theSecret: string | null;\r\n\r\n  const start = async () => {\r\n    isTimeout.value = false;\r\n    time = 0;\r\n    isLoading.value = true;\r\n    try {\r\n      theSecret = null;\r\n      theSecret = await getSecret();\r\n    } catch (error) {\r\n      console.log(\"获取密钥失败\", error);\r\n      throw new Error(\"获取密钥失败\");\r\n    }\r\n    isLoading.value = false;\r\n    if (!theSecret) {\r\n      return;\r\n    }\r\n    theInterval = window.setInterval(async () => {\r\n      time += intevalTimeout;\r\n      if (time > timeout) {\r\n        return stop();\r\n      }\r\n\r\n      try {\r\n        const loginInfo = await verifyLogin(theSecret as string);\r\n        if (loginInfo) {\r\n          stop();\r\n          onPass && onPass(loginInfo);\r\n        }\r\n      } catch (error) {\r\n        stop();\r\n        console.error(\"校验登录失败\", error);\r\n        throw new Error(\"校验登录失败\");\r\n      }\r\n    }, intevalTimeout);\r\n  };\r\n  const stop = () => {\r\n    isTimeout.value = true;\r\n    theInterval && clearInterval(theInterval);\r\n  };\r\n\r\n  onUnmounted(stop);\r\n  return {\r\n    isTimeout,\r\n    isLoading,\r\n    start,\r\n  };\r\n};\r\n"],"names":["useScanLogin","getSecret","intevalTimeout","timeout","verifyLogin","onPass","isTimeout","ref","isLoading","theInterval","time","theSecret","start","error","stop","loginInfo","onUnmounted"],"mappings":"uGAWaA,EAAe,CAAC,CAC3B,UAAAC,EACA,eAAAC,EAAiB,EAAI,IACrB,QAAAC,EAAU,IAAM,IAChB,YAAAC,EACA,OAAAC,CACF,IAAuB,CACf,MAAAC,EAAYC,MAAI,EAAK,EACrBC,EAAYD,MAAI,EAAK,EACvB,IAAAE,EACAC,EAAO,EACPC,EAEJ,MAAMC,EAAQ,SAAY,CACxBN,EAAU,MAAQ,GACXI,EAAA,EACPF,EAAU,MAAQ,GACd,GAAA,CACUG,EAAA,KACZA,EAAY,MAAMV,UACXY,EAAO,CACN,cAAA,IAAI,SAAUA,CAAK,EACrB,IAAI,MAAM,QAAQ,CAC1B,CACAL,EAAU,MAAQ,GACbG,IAGSF,EAAA,OAAO,YAAY,SAAY,CAE3C,GADQC,GAAAR,EACJQ,EAAOP,EACT,OAAOW,EAAK,EAGV,GAAA,CACI,MAAAC,EAAY,MAAMX,EAAYO,CAAmB,EACnDI,IACGD,IACLT,GAAUA,EAAOU,CAAS,SAErBF,EAAO,CACT,MAAAC,IACG,QAAA,MAAM,SAAUD,CAAK,EACvB,IAAI,MAAM,QAAQ,CAC1B,GACCX,CAAc,EAAA,EAEbY,EAAO,IAAM,CACjBR,EAAU,MAAQ,GAClBG,GAAe,cAAcA,CAAW,CAAA,EAG1CO,OAAAA,EAAA,YAAYF,CAAI,EACT,CACL,UAAAR,EACA,UAAAE,EACA,MAAAI,CAAA,CAEJ"}